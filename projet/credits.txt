
# Création des certificates Etape 1 et 2
https://www.developpez.net/forums/d1967885/systemes/linux/securite/proftpd-creer-certificat-intermediaire-cert-user/

 openssl pkcs12 -export -inkey C:\Users\user\Desktop\2022-2023\Cours ISEN\Crypto\crypto\projet\ACI\intermediate.key -in server.crt -name alicePKCS -out root.pfx  

 # Création server OSCP 
openssl req -newkey rsa:2048 -keyout ocsp.key -out ocsp.csr
openssl x509 -req -in ocsp.csr -CA CA.crt -CAkey CA.key -CAcreateserial -out ocsp.crt -days 365

Configurer le serveur OCSP :
openssl ocsp -port 8080 -index index.txt -rsigner ocsp.crt -rkey ocsp.key -CA CA.crt -text -out ocsp.log

Ajouter l'adresse du serveur OCSP au certificat du serveur web :
openssl x509 -in server.crt -out server.pem -outform PEM
openssl x509 -in server.pem -text -noout | grep DNS
openssl x509 -req -in server.csr -out server.crt -sha256 -CA CA.crt -CAkey CA.key -CAcreateserial -extfile server.ext

Modifier le fichier server.ext pour ajouter l'adresse du serveur OCSP :
authorityInfoAccess = OCSP;URI:http://ocsp.example.com

Signer le nouveau certificat avec le certificat de l'autorité de certification :
openssl x509 -req -in server.csr -out server.crt -sha256 -CA CA.crt -CAkey CA.key -CAcreateserial -extfile server.ext

Révoquer un certificat :
openssl ca -config openssl.cnf -revoke client.crt
openssl ca -config openssl.cnf -gencrl -out ca.crl

Vérifier la révocation :
openssl ocsp -issuer CA.crt -cert client.crt -url http://ocsp.example.com:8080 -resp_text
